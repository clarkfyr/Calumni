<div class="header">
  <% if @over_ten %>
   <%= link_to 'Show Previous', '?m=all' %>
  <% end %>
</div>

<% if @conversation.recipient_id == current_user.id%>
    <%@other_id = @conversation.sender_id%>
<% else %>
    <%@other_id = @conversation.recipient_id%>
<% end %>
<% @show_checkbox = ((@conversation.help_status=="Reject") or (@conversation.help_status=="Done") or (@conversation.help_status==""))%>
<% @show_options = (((@conversation.help_status=="Pending") or (@conversation.help_status=="Accept")) and (@conversation.requester!=current_user.id))%>


<div class="header">
  <strong>Talking to: <%=People.find(@other_id).username%></strong><br/><br/>


  <% if @conversation.help_status != "" %>
      <% if @conversation.requester == current_user.id%>
          <%@requester_name = "me"%>
      <% else %>
          <%@requester_name = People.find_by_id(@conversation.requester).username%>
      <% end %>
      Helped <%=@requester_name %>
      with request <strong><% if @conversation.help_type%><%=@conversation.help_type%><% end %></strong>
      <br/>Help Status: <strong><% if @conversation.help_status%><%=@conversation.help_status%><% end %></strong><br/><br/>
  <%end%>

</div>

<div class="field", name="history", id="history">
  <% @messages.each do |message| %>
    <% if message.body %>
      <% people = People.find(message.people_id) %>
      <div class="item">
        <div class="content">
          <div class="header"><strong><%= people.username %></strong> <%= message.message_time %></div>
          <div class="list">
            <div class="item">
              <i class="right triangle icon"></i>
              <%= message.body %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  <% end %>
</div>


<br />Message<br /></br>

<%= form_for [@conversation, @message], html: {class: "ui reply form"} do |f| %>

    <div class="field",  name="msg_body">
    <%= f.text_area :body, class: "form-control" %>
    </div>

  <div class="field">
    <%= f.text_field :people_id, value: current_user.id, type: "hidden"  %>
    <% if @conversation.recipient_id == current_user.id%>
        <%@other_id = @conversation.sender_id%>
    <% else %>
        <%@other_id = @conversation.recipient_id%>
    <% end %>
  </div>

  <div class="field">
    <% if @show_checkbox%>
        <% @is_mentor=(People.find(@other_id).role == "mentor")%>
        <% if @is_mentor%>
          <!-- <% @help_with=People.find(@other_id).helpability%> -->
          <% @all_help_type=[]%>
          <% People.find(@other_id).helpability.each do |help| %>
            <% if help != ""%>
              <% @all_help_type.push(help) %>
            <% end %>
          <% end %>
          <% if @all_help_type != []%>
            <%="Available to help with: " + @all_help_type.to_s %><br/>
          <% else %>
            <%="Available to help with: " + '["General Help"]'.to_s %><br/>
          <% end %>
          <%="Please only choose at most one help"%><br/>
        <ul>
          <% People.all_helps.each do |help| %>
              <li>
                <%= check_box_tag "helps[#{help}]", 1, false, disabled: !@help_with.include?(help) && help != "general advice", :id => "helps_#{help}" -%>
                <%= h help -%>
              </li>
          <% end %>
        </ul>
        <% end %>
    <% end %>


    <% if flash[:notice] %>
        <div class="notice" id="notice"><%=flash[:notice] %></div>
    <% end %>

  </div>

    <div class="field">
      <% if @show_options%>
        <% if @conversation.help_status == "Pending" %>
          <br/><br/><%= f.submit "Accept", class: "ui green labeled submit icon button" %> <%= f.submit "Reject", class: "ui red labeled submit icon button" %><br/><br/>
        <% elsif @conversation.help_status == "Accept" %>
          <br/><br/><%= f.submit "Mark as Done", class: "ui grey labeled submit icon button" %>  <%= f.submit "Send", class: "ui blue labeled submit icon button" %>
        <% end %>
      <% else %>
        <%= f.submit "Send", class: "ui blue labeled submit icon button" %>
      <% end %>
    </div>
<% end %>
